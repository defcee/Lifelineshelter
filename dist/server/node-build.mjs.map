{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/auth.ts","../../server/routes/get-involved.ts","../../server/index.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import { RequestHandler } from \"express\";\r\nimport { AdminLoginRequest, AdminLoginResponse } from \"@shared/api\";\r\n\r\n// In production, use proper password hashing with bcrypt\r\n// For now, using environment variables\r\nconst ADMIN_USERNAME = process.env.ADMIN_USERNAME || \"admin\";\r\nconst ADMIN_PASSWORD = process.env.ADMIN_PASSWORD || \"admin123\";\r\n\r\n// Simple token generation (in production, use JWT)\r\nfunction generateToken(username: string): string {\r\n  return Buffer.from(`${username}:${Date.now()}`).toString(\"base64\");\r\n}\r\n\r\nexport const handleAdminLogin: RequestHandler = (req, res) => {\r\n  const { username, password } = req.body as AdminLoginRequest;\r\n\r\n  // Validate input\r\n  if (!username || !password) {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: \"Username and password are required\",\r\n    } as AdminLoginResponse);\r\n  }\r\n\r\n  // Check credentials\r\n  if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {\r\n    const token = generateToken(username);\r\n\r\n    return res.status(200).json({\r\n      success: true,\r\n      message: \"Login successful\",\r\n      token,\r\n      admin: {\r\n        username,\r\n        email: process.env.ADMIN_EMAIL,\r\n      },\r\n    } as AdminLoginResponse);\r\n  }\r\n\r\n  // Invalid credentials\r\n  res.status(401).json({\r\n    success: false,\r\n    message: \"Invalid username or password\",\r\n  } as AdminLoginResponse);\r\n};\r\n\r\nexport const handleAdminDashboard: RequestHandler = (req, res) => {\r\n  const token = req.headers.authorization?.replace(\"Bearer \", \"\");\r\n\r\n  if (!token) {\r\n    return res.status(401).json({\r\n      authenticated: false,\r\n      message: \"No authorization token provided\",\r\n    });\r\n  }\r\n\r\n  // Simple token validation (in production, verify JWT)\r\n  try {\r\n    const decoded = Buffer.from(token, \"base64\").toString(\"utf-8\");\r\n    const [username] = decoded.split(\":\");\r\n\r\n    res.status(200).json({\r\n      authenticated: true,\r\n      message: \"Authenticated\",\r\n      user: { username },\r\n    });\r\n  } catch {\r\n    res.status(401).json({\r\n      authenticated: false,\r\n      message: \"Invalid or expired token\",\r\n    });\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport nodemailer from \"nodemailer\";\r\n\r\nconst EMAIL_TO = process.env.CONTACT_EMAIL || \"customerrepresentative@lifelineshelter.com\";\r\n\r\nexport const handleGetInvolved: RequestHandler = async (req, res) => {\r\n  const { firstName, lastName, email, type, message } = req.body || {};\r\n  if (!firstName || !lastName || !email || !type || !message) {\r\n    return res.status(400).json({ message: \"All fields are required.\" });\r\n  }\r\n\r\n  try {\r\n    // Check if SMTP is configured\r\n    if (!process.env.SMTP_HOST || !process.env.SMTP_USER || !process.env.SMTP_PASS) {\r\n      console.warn(\"‚ö†Ô∏è  SMTP not configured. Email may not be sent. Configure SMTP_HOST, SMTP_USER, SMTP_PASS in .env\");\r\n      return res.status(200).json({ message: \"Your submission has been received. We will contact you soon.\" });\r\n    }\r\n\r\n    const transporter = nodemailer.createTransport({\r\n      host: process.env.SMTP_HOST,\r\n      port: Number(process.env.SMTP_PORT) || 465,\r\n      secure: true, // Required for port 465\r\n      auth: {\r\n        user: process.env.SMTP_USER,\r\n        pass: process.env.SMTP_PASS,\r\n      },\r\n    });\r\n\r\n    const mailOptions = {\r\n      from: `LifeLine Shelter <${process.env.SMTP_USER}>`,\r\n      to: EMAIL_TO,\r\n      subject: `[LifeLine] New ${type} Submission from ${firstName} ${lastName}`,\r\n      replyTo: email,\r\n      text: `Name: ${firstName} ${lastName}\\nEmail: ${email}\\nType: ${type}\\nMessage:\\n${message}`,\r\n      html: `<p><strong>Name:</strong> ${firstName} ${lastName}</p><p><strong>Email:</strong> ${email}</p><p><strong>Type:</strong> ${type}</p><p><strong>Message:</strong><br/>${message.replace(/\\n/g, '<br/>')}</p>`\r\n    };\r\n\r\n    await transporter.sendMail(mailOptions);\r\n    res.status(200).json({ message: \"Your message has been sent. Thank you!\" });\r\n  } catch (err) {\r\n    res.status(500).json({ message: \"Failed to send email. Please try again later.\" });\r\n  }\r\n};\r\n","import \"dotenv/config\";\r\nimport express from \"express\";\r\nimport cors from \"cors\";\r\nimport { handleDemo } from \"./routes/demo\";\r\nimport { handleAdminLogin, handleAdminDashboard } from \"./routes/auth\";\r\nimport { handleGetInvolved } from \"./routes/get-involved\";\r\n\r\nexport function createServer() {\r\n  const app = express();\r\n\r\n  // Middleware\r\n  app.use(cors());\r\n  app.use(express.json());\r\n  app.use(express.urlencoded({ extended: true }));\r\n\r\n  // Example API routes\r\n  app.get(\"/api/ping\", (_req, res) => {\r\n    const ping = process.env.PING_MESSAGE ?? \"ping\";\r\n    res.json({ message: ping });\r\n  });\r\n\r\n  app.get(\"/api/demo\", handleDemo);\r\n\r\n\r\n  // Admin authentication routes\r\n  app.post(\"/api/admin/login\", handleAdminLogin);\r\n  app.get(\"/api/admin/dashboard\", handleAdminDashboard);\r\n\r\n  // Get Involved form submission\r\n  app.post(\"/api/get-involved\", handleGetInvolved);\r\n\r\n  // Ensure any unmatched API route returns JSON (prevents HTML index being returned for API requests)\r\n  app.all(\"/api/*\", (_req, res) => {\r\n    res.status(404).json({ error: \"API endpoint not found\" });\r\n  });\r\n\r\n  return app;\r\n}\r\n","import path from \"path\";\r\nimport express from \"express\";\r\nimport { createServer } from \"./index\";\r\n\r\nconst app = createServer();\r\nconst port = process.env.PORT || 3000;\r\n\r\n// In production, serve the built SPA files\r\nconst __dirname = import.meta.dirname;\r\nconst distPath = path.join(__dirname, \"../spa\");\r\n\r\n// Serve static files\r\napp.use(express.static(distPath));\r\n\r\n// Handle React Router - serve index.html for all non-API routes\r\napp.get(\"*\", (req, res) => {\r\n  // Don't serve index.html for API routes\r\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\r\n    return res.status(404).json({ error: \"API endpoint not found\" });\r\n  }\r\n\r\n  res.sendFile(path.join(distPath, \"index.html\"));\r\n});\r\n\r\napp.listen(port, () => {\r\n  console.log(`üöÄ Fusion Starter server running on port ${port}`);\r\n  console.log(`üì± Frontend: http://localhost:${port}`);\r\n  console.log(`üîß API: http://localhost:${port}/api`);\r\n});\r\n\r\n// Graceful shutdown\r\nprocess.on(\"SIGTERM\", () => {\r\n  console.log(\"üõë Received SIGTERM, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n\r\nprocess.on(\"SIGINT\", () => {\r\n  console.log(\"üõë Received SIGINT, shutting down gracefully\");\r\n  process.exit(0);\r\n});\r\n"],"names":["app","__dirname"],"mappings":"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"}