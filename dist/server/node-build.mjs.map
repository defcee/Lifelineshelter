{"version":3,"file":"node-build.mjs","sources":["../../server/routes/demo.ts","../../server/routes/auth.ts","../../server/routes/get-involved.ts","../../server/node-build.ts"],"sourcesContent":["import { RequestHandler } from \"express\";\nimport { DemoResponse } from \"@shared/api\";\n\nexport const handleDemo: RequestHandler = (req, res) => {\n  const response: DemoResponse = {\n    message: \"Hello from Express server\",\n  };\n  res.status(200).json(response);\n};\n","import { RequestHandler } from \"express\";\r\nimport { AdminLoginRequest, AdminLoginResponse } from \"@shared/api\";\r\n\r\n// In production, use proper password hashing with bcrypt\r\n// For now, using environment variables\r\nconst ADMIN_USERNAME = process.env.ADMIN_USERNAME || \"admin\";\r\nconst ADMIN_PASSWORD = process.env.ADMIN_PASSWORD || \"admin123\";\r\n\r\n// Simple token generation (in production, use JWT)\r\nfunction generateToken(username: string): string {\r\n  return Buffer.from(`${username}:${Date.now()}`).toString(\"base64\");\r\n}\r\n\r\nexport const handleAdminLogin: RequestHandler = (req, res) => {\r\n  const { username, password } = req.body as AdminLoginRequest;\r\n\r\n  // Validate input\r\n  if (!username || !password) {\r\n    return res.status(400).json({\r\n      success: false,\r\n      message: \"Username and password are required\",\r\n    } as AdminLoginResponse);\r\n  }\r\n\r\n  // Check credentials\r\n  if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {\r\n    const token = generateToken(username);\r\n\r\n    return res.status(200).json({\r\n      success: true,\r\n      message: \"Login successful\",\r\n      token,\r\n      admin: {\r\n        username,\r\n        email: process.env.ADMIN_EMAIL,\r\n      },\r\n    } as AdminLoginResponse);\r\n  }\r\n\r\n  // Invalid credentials\r\n  res.status(401).json({\r\n    success: false,\r\n    message: \"Invalid username or password\",\r\n  } as AdminLoginResponse);\r\n};\r\n\r\nexport const handleAdminDashboard: RequestHandler = (req, res) => {\r\n  const token = req.headers.authorization?.replace(\"Bearer \", \"\");\r\n\r\n  if (!token) {\r\n    return res.status(401).json({\r\n      authenticated: false,\r\n      message: \"No authorization token provided\",\r\n    });\r\n  }\r\n\r\n  // Simple token validation (in production, verify JWT)\r\n  try {\r\n    const decoded = Buffer.from(token, \"base64\").toString(\"utf-8\");\r\n    const [username] = decoded.split(\":\");\r\n\r\n    res.status(200).json({\r\n      authenticated: true,\r\n      message: \"Authenticated\",\r\n      user: { username },\r\n    });\r\n  } catch {\r\n    res.status(401).json({\r\n      authenticated: false,\r\n      message: \"Invalid or expired token\",\r\n    });\r\n  }\r\n};\r\n","import { RequestHandler } from \"express\";\r\nimport nodemailer from \"nodemailer\";\r\n\r\nconst EMAIL_TO = process.env.CONTACT_EMAIL || \"customerrepresentative@lifelineshelter.com\";\r\n\r\nexport const handleGetInvolved: RequestHandler = async (req, res) => {\r\n  const { firstName, lastName, email, type, message } = req.body || {};\r\n  if (!firstName || !lastName || !email || !type || !message) {\r\n    return res.status(400).json({ message: \"All fields are required.\" });\r\n  }\r\n\r\n  try {\r\n    // Check if SMTP is configured\r\n    if (!process.env.SMTP_HOST || !process.env.SMTP_USER || !process.env.SMTP_PASS) {\r\n      console.warn(\"‚ö†Ô∏è  SMTP not configured. Email may not be sent. Configure SMTP_HOST, SMTP_USER, SMTP_PASS in .env\");\r\n      return res.status(200).json({ message: \"Your submission has been received. We will contact you soon.\" });\r\n    }\r\n\r\n    const transporter = nodemailer.createTransport({\r\n  host: \"email-smtp.us-east-1.amazonaws.com\",\r\n  port: 465, \r\n  secure: true,\r\n  auth: {\r\n        user: process.env.SMTP_USER,\r\n        pass: process.env.SMTP_PASS,\r\n      },\r\n    });\r\n\r\n    const mailOptions = {\r\n      from: `LifeLine Shelter <${process.env.SMTP_USER}>`,\r\n      to: EMAIL_TO,\r\n      subject: `[LifeLine] New ${type} Submission from ${firstName} ${lastName}`,\r\n      replyTo: email,\r\n      text: `Name: ${firstName} ${lastName}\\nEmail: ${email}\\nType: ${type}\\nMessage:\\n${message}`,\r\n      html: `<p><strong>Name:</strong> ${firstName} ${lastName}</p><p><strong>Email:</strong> ${email}</p><p><strong>Type:</strong> ${type}</p><p><strong>Message:</strong><br/>${message.replace(/\\n/g, '<br/>')}</p>`\r\n    };\r\n\r\n    await transporter.sendMail(mailOptions);\r\n    res.status(200).json({ message: \"Your message has been sent. Thank you!\" });\r\n  } catch (err) {\r\n    console.error(\"Email send error:\", err instanceof Error ? err.message : err);\r\n    res.status(500).json({\r\n      message: \"Failed to send email. Please try again later.\",\r\n      error: err instanceof Error ? err.message : \"Unknown error\"\r\n    });\r\n  }\r\n};\r\n","import \"dotenv/config\";\nimport path from \"path\";\nimport { fileURLToPath } from \"url\";\nimport express from \"express\";\nimport cors from \"cors\";\nimport { handleDemo } from \"./routes/demo.js\";\nimport { handleAdminLogin, handleAdminDashboard } from \"./routes/auth.js\";\nimport { handleGetInvolved } from \"./routes/get-involved.js\";\n\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\n\n// ----------------------\n// Create Express Server\n// ----------------------\nfunction createServer() {\n  const app = express();\n\n  app.use(cors());\n  app.use(express.json());\n  app.use(express.urlencoded({ extended: true }));\n\n  // ----------------------\n  // API Routes\n  // ----------------------\n\n  // Health check\n  app.get(\"/api/ping\", (_req, res) => {\n    const ping = process.env.PING_MESSAGE ?? \"ping pong\";\n    res.json({ message: ping });\n  });\n\n  app.get(\"/api/demo\", handleDemo);\n\n  // Admin authentication routes\n  app.post(\"/api/admin/login\", handleAdminLogin);\n  app.get(\"/api/admin/dashboard\", handleAdminDashboard);\n\n  // Get Involved form submission\n  app.post(\"/api/get-involved\", handleGetInvolved);\n\n  // Catch-all for unknown API endpoints\n  app.all(\"/api/:splat*\", (_req, res) => {\n    res.status(404).json({ error: \"API endpoint not found\" });\n  });\n\n  return app;\n}\n\n// ----------------------\n// Start Server\n// ----------------------\nconst PORT = Number(process.env.PORT) || 3000;\nconst app = createServer();\n\n// ----------------------\n// Serve SPA\n// ----------------------\n// Resolve SPA path relative to the directory where node-build.mjs is running\nconst spaPath = path.resolve(__dirname, \"../spa\");\napp.use(express.static(spaPath));\n\n// SPA routing: serve index.html for all non-API routes\napp.get(\"*\", (req, res) => {\n  if (req.path.startsWith(\"/api/\") || req.path.startsWith(\"/health\")) {\n    return res.status(404).json({ error: \"API endpoint not found\" });\n  }\n  res.sendFile(path.join(spaPath, \"index.html\"), (err) => {\n    if (err) {\n      console.error(`Error serving index.html from ${spaPath}:`, err.message);\n      res.status(500).json({ error: \"Failed to serve index.html\" });\n    }\n  });\n});\n\n// ----------------------\n// Start listening\n// ----------------------\napp.listen(PORT, () => {\n  console.log(`üöÄ Server running on port ${PORT}`);\n  console.log(`üì± Frontend available at /`);\n  console.log(`üîß API available at /api/`);\n});\n\n// ----------------------\n// Graceful shutdown\n// ----------------------\nprocess.on(\"SIGTERM\", () => process.exit(0));\nprocess.on(\"SIGINT\", () => process.exit(0));\n"],"names":["__dirname","app"],"mappings":"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"}